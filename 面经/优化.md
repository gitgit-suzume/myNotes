> 优化

## 一次js请求一般情况下，哪些地方会有缓存处理

* dns缓存
* cdn缓存
* 浏览器缓存
* 服务器缓存

## 为什么利用多个域名来提供网站资源会更有效？

* CDN缓存更方便
* 突破浏览器并发限制（一般每个域名建立的链接不超过6个）
* Cookieless，节省带宽，尤其是上行带宽一般比下行要慢
* 对于UGC的内容和主站隔离，防止不必要的安全问题(上传js窃取主站cookie之类的)。正是这个原因要求用户内容的域名必须不是自己主站的子域名，而是一个完全独立的第三方域名。
* 数据做了划分，甚至切到了不同的物理集群，通过子域名来分流比较省事。
ps: 关于Cookie的问题，带宽是次要的，安全隔离才是主要的。关于多域名，也不是越多越好，虽然服务器端可以做泛解释，浏览器做dns解释也是耗时间的，而且太多域名，如果要走https的话，还有要多买证书和部署的问题。

## 性能优化
* 代码：
    避免使用css表达式、避免使用高级选择器、避免使用通配符
* 缓存利用：
    缓存ajax、使用cdn、使用外部js、css文件便于缓存、添加Expires头、服务端配置Etag、减少DNS查找等
* 请求数量：
    合并样式和脚本、使用css图片精灵、初始首屏之外的图片资源按需加载、静态资源延迟加载
* 请求带宽：
    压缩文件、开启GZIP

## 代码层面优化
* 用hash-table优化查找
* 少用全局变量
* 用innerHTML代替DOM操作，减少DOM操作次数，优化js性能
* 用setTimeout避免页面失去响应（长时间、不急的处理用setTimeout(..., 250))
* 缓存DOM节点查找的结果
* 避免使用css expression
* 避免全局查询
* 避免使用with（with会自己创建作用域，增加作用域链长度）
* 多个变量声明合并
* 避免空src，空src会重新加载当前页面，影响速度和效率
* 尽量避免在html标签中写style属性

## 移动端性能优化
// 尽量使用css3动画，开启硬件加速，但是不能随便乱开，很吃内存和电量的
// 用transform: translateZ(0) 开启硬件加速
* 适当使用touch代替click
* 避免用css3渐变阴影效果
* css3属性(transition, 3D transform, opacity, canvas, webGL, Video)会触发GPU渲染，合理使用，滥用号店
* 不滥用float（float渲染时计算量大）
* 少用web字体
* 合理用requestAnimationFrame代替setTimeout
* pc端在移动端同样适用

## IE缓存问题
ie浏览器下，get请求，且url不变，那么请求结果会被缓存
改变方法是，在url末尾添加上随机的时间戳参数('t' += new Date().getTIme())

## 重构

###### 网站重构

在不改变网站ui的前提下，对网站进行优化、扩展。
一般有以下内容：
* table 布局改为 div+css
* 兼容现代浏览器
* 移动平台优化
* seo优化
* 减少代码耦合
* 保持代码弹性
* 规范代码
* 设计可扩展api
* 代替就有框架、语言
* 增强用户体验
* 优化速度
* 压缩js、css、img等资源
* 程序性能优化
* 采用cdn加速资源加载
* 优化js dom
* http服务器文件缓存

## 网页优化

* 内容优化
    * 减少http请求（雪碧图、合并js、合并css、base64编码）
    * 减少dns查找
    * 使用缓存——ajax缓存
    * 减少dom数量，程序运行时dom少了遍历也快点
    * 避免404错误（src、href为空）
* 服务器优化
    * 使用cdn分布式网络
    * 添加expires、cache-control请求头，
    * 设置Etag
    * gzip压缩
    * ajax使用get方法、因为浏览器post方法会首先发送文件头，然后才发送数据。
    * 启用keep-alive（http1.1），保持长连接
    * 将小的css、js内嵌到html中，减少请求次数

* cookie
    8 减少cookie数量大小，去除不必要的cookie
* css
    * 少用css表达式
    * css代码放在html页面顶部
    * 引入css用link而不是@import

* js
    * js脚本写在页面底部
    * js、css引用外来文件，不要写在html里面，这个可以利用缓存
    * 用压缩工具比如gulp对js、css文件进行压缩，去除多余的空格、换行、注释
    * js合并成一个文件
    * 尽量减少dom元素的操作
    * js执行时间过长，并且任务重，不需要按顺序执行的那种。可以划分成一小块一小块，用setTime间隔执行，时间间隔设为250ms，防止浏览器卡死
    * 延迟js加载

* 图片
    * 优化图片大小
    * 不要再html中使用缩放图片
    * ico要小并且可缓存
    * 图片写大小，减少重绘、回流
    * 图片用jpg不用png
    * 小图base64编码（webpack），会增加请求文件大小，但是可以减少请求次数

